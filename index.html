<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <title>–°—Ç—Ä–∞—à–Ω—ã–π –ª–µ—Å</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <style>
        :root {
            --color-bg-forest: #0a0a0a;
            --color-accent: #dc2626;
            --color-player: #3b82f6;
            --color-enemy: #ff5459;
            --color-enemy-fast: #3b82f6;
            --color-boss: #8b0000;
            --color-text: #ffffff;
            --color-ui-bg: rgba(0, 0, 0, 0.85);
            --color-coin: #fbbf24;
            --color-shop: #16a34a;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;
            background: var(--color-bg-forest);
            color: var(--color-text);
            overflow: hidden;
            touch-action: none;
        }

        /* –û–±—â–∏–µ —ç–∫—Ä–∞–Ω—ã */
        #menuScreen,
        #gameScreen,
        #instructionsScreen,
        #aboutScreen,
        #shopScreen {
            position: fixed;
            inset: 0;
            display: none;
            align-items: center;
            justify-content: center;
        }

        /* –ú–µ–Ω—é */
        #menuScreen {
            background: radial-gradient(circle at 20% 20%, #111 0, #000 40%, #000 100%);
            flex-direction: column;
        }

        .logo {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: linear-gradient(45deg, #dc2626, #000);
            background-size: cover;
            background-position: center;
            box-shadow: 0 20px 40px rgba(220, 38, 38, 0.3);
            margin-bottom: 40px;
            animation: float 3s ease-in-out infinite;
            position: relative;
            overflow: hidden;
        }

        .logo::before {
            content: "üå≤";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 80px;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .menu-button {
            width: 260px;
            padding: 14px 24px;
            margin: 8px;
            border-radius: 14px;
            border: none;
            background: var(--color-accent);
            color: var(--color-text);
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 10px 25px rgba(220, 38, 38, 0.3);
            transition: transform 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
        }

        .menu-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 16px 40px rgba(220, 38, 38, 0.5);
            background: #b91c1c;
        }

        .menu-button:active {
            transform: translateY(0);
            box-shadow: 0 8px 18px rgba(220, 38, 38, 0.3);
        }

        /* –¢–µ–∫—Å—Ç–æ–≤—ã–µ —ç–∫—Ä–∞–Ω—ã */
        .content-box {
            background: var(--color-ui-bg);
            padding: 26px;
            border-radius: 16px;
            max-width: 620px;
            max-height: 80vh;
            overflow-y: auto;
            margin: 20px;
            border: 2px solid var(--color-accent);
        }

        .content-box h2 {
            color: var(--color-accent);
            margin-bottom: 14px;
            font-size: 24px;
        }

        .content-box p {
            margin-bottom: 10px;
            line-height: 1.6;
            font-size: 15px;
        }

        .back-button {
            position: fixed;
            top: 16px;
            left: 16px;
            padding: 10px 18px;
            border-radius: 10px;
            border: none;
            background: var(--color-accent);
            color: var(--color-text);
            font-size: 15px;
            cursor: pointer;
            z-index: 10;
        }

        /* –ò–≥—Ä–∞ */
        #gameScreen {
            background: #000;
        }

        #gameCanvas {
            display: block;
            width: 100vw;
            height: 100vh;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }

        .ui-panel {
            position: fixed;
            top: 14px;
            left: 14px;
            background: var(--color-ui-bg);
            padding: 12px 14px;
            border-radius: 12px;
            font-size: 13px;
            line-height: 1.5;
            z-index: 10;
            min-width: 190px;
            border: 2px solid var(--color-accent);
        }

        .coin-panel {
            position: fixed;
            top: 110px;
            left: 14px;
            background: var(--color-ui-bg);
            padding: 12px 14px;
            border-radius: 12px;
            font-size: 13px;
            z-index: 10;
            min-width: 190px;
            border: 2px solid var(--color-coin);
        }

        .minimap {
            position: fixed;
            top: 14px;
            right: 14px;
            width: 150px;
            height: 150px;
            border-radius: 12px;
            border: 3px solid #808080;
            background: rgba(128, 128, 128, 0.3);
            z-index: 10;
        }

        /* –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –¥–∂–æ–π—Å—Ç–∏–∫ */
        .joystick-container {
            position: fixed;
            bottom: 40px;
            left: 36px;
            width: 120px;
            height: 120px;
            display: none;
            z-index: 20;
        }

        .joystick-base {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 3px solid var(--color-accent);
            background: rgba(220, 38, 38, 0.25);
            position: relative;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.5);
        }

        .joystick-stick {
            width: 52px;
            height: 52px;
            border-radius: 50%;
            background: var(--color-accent);
            border: 3px solid var(--color-text);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.6);
            transition: transform 0.08s ease;
        }

        .attack-button {
            position: fixed;
            bottom: 52px;
            right: 52px;
            width: 82px;
            height: 82px;
            border-radius: 50%;
            border: 3px solid var(--color-text);
            background: rgba(220, 38, 38, 0.85);
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            z-index: 20;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.6);
            user-select: none;
        }

        .attack-button:active {
            transform: scale(0.95);
            background: rgba(220, 38, 38, 1);
        }

        /* –ú–∞–≥–∞–∑–∏–Ω */
        #shopScreen {
            background: rgba(0, 0, 0, 0.95);
            z-index: 30;
        }

        .shop-container {
            background: var(--color-ui-bg);
            padding: 30px;
            border-radius: 20px;
            max-width: 800px;
            max-height: 85vh;
            overflow-y: auto;
            border: 3px solid var(--color-shop);
        }

        .shop-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .shop-title {
            color: var(--color-shop);
            font-size: 28px;
        }

        .shop-coin {
            color: var(--color-coin);
            font-size: 24px;
            font-weight: bold;
        }

        .shop-items {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .shop-item {
            background: rgba(30, 30, 30, 0.8);
            border: 2px solid var(--color-accent);
            border-radius: 12px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .shop-item:hover {
            transform: translateY(-3px);
            border-color: var(--color-coin);
        }

        .shop-item.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .shop-item.disabled:hover {
            transform: none;
            border-color: var(--color-accent);
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .item-name {
            color: var(--color-text);
            font-size: 18px;
            font-weight: bold;
        }

        .item-price {
            color: var(--color-coin);
            font-size: 16px;
            font-weight: bold;
        }

        .item-description {
            color: #ccc;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .item-stats {
            color: #aaa;
            font-size: 12px;
            font-style: italic;
        }

        /* Game over */
        .game-over-screen {
            position: fixed;
            inset: 0;
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            background: rgba(0, 0, 0, 0.95);
            z-index: 30;
        }

        .game-over-screen h1 {
            font-size: 40px;
            color: var(--color-accent);
            margin-bottom: 14px;
        }

        .game-over-screen p {
            margin: 4px 0;
            font-size: 16px;
        }

        /* –ó–∞–≥—Ä—É–∑–æ—á–Ω—ã–π —ç–∫—Ä–∞–Ω */
        #loadingScreen {
            position: fixed;
            inset: 0;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            z-index: 50;
            cursor: pointer;
        }

        #loadingTitle {
            color: #dc2626;
            font-size: 44px;
            font-weight: 700;
            letter-spacing: 0.24em;
            text-align: center;
            text-transform: uppercase;
            text-shadow: 0 0 20px rgba(220, 38, 38, 0.7);
        }

        #loadingTitle span {
            display: inline-block;
            animation: blink-letter 1.4s infinite ease-in-out;
        }

        @keyframes blink-letter {
            0%   { opacity: 0.2; transform: translateY(0); }
            40%  { opacity: 1;   transform: translateY(-4px); text-shadow: 0 0 25px rgba(220, 38, 38, 1); }
            100% { opacity: 0.2; transform: translateY(0); }
        }

        .loading-hint {
            margin-top: 26px;
            font-size: 14px;
            color: #dc2626;
            opacity: 0.8;
        }

        .fade-out {
            animation: fadeOut 0.5s forwards ease-in-out;
        }

        @keyframes fadeOut {
            to { opacity: 0; pointer-events: none; }
        }

        /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è */
        @media (max-width: 600px) {
            .ui-panel {
                font-size: 12px;
            }
            .coin-panel {
                top: 96px;
                width: 190px;
            }
            .minimap {
                width: 120px;
                height: 120px;
            }
            .shop-items {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- –ó–∞–≥—Ä—É–∑–æ—á–Ω—ã–π —ç–∫—Ä–∞–Ω -->
    <div id="loadingScreen">
        <h1 id="loadingTitle">–°–¢–†–ê–®–ù–´–ô –õ–ï–°</h1>
        <div class="loading-hint">–ù–∞–∂–º–∏ / —Ç–∞–ø–Ω–∏, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å</div>
    </div>

    <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
    <div id="menuScreen">
        <div class="logo"></div>
        <button class="menu-button" onclick="startGame()">–ù–ê–ß–ù–Å–ú</button>
        <button class="menu-button" onclick="showInstructions()">–ö–ê–ö –ò–ì–†–ê–¢–¨</button>
        <button class="menu-button" onclick="showAbout()">–û–ë –ò–ì–†–ï</button>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π -->
    <div id="instructionsScreen">
        <button class="back-button" onclick="showMenu()">‚Üê –ù–∞–∑–∞–¥</button>
        <div class="content-box">
            <h2>üå≤ –ö–∞–∫ –∏–≥—Ä–∞—Ç—å</h2>
            <p><strong>–¶–µ–ª—å:</strong> –í—ã–∂–∏–≤–∞–π –∫–∞–∫ –º–æ–∂–Ω–æ –¥–æ–ª—å—à–µ –∏ —Å–æ–±–∏—Ä–∞–π –º–æ–Ω–µ—Ç—ã!</p>
            <p><strong>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:</strong></p>
            <p>‚Ä¢ –°–æ–±–∏—Ä–∞–π –º–æ–Ω–µ—Ç—ã –¥–ª—è –ø–æ–∫—É–ø–æ–∫ –≤ –º–∞–≥–∞–∑–∏–Ω–µ</p>
            <p>‚Ä¢ –ö–∞–∂–¥—ã–µ 5 –≤–æ–ª–Ω –ø–æ—è–≤–ª—è–µ—Ç—Å—è –±–æ—Å—Å (—Å–∏–ª—å–Ω–µ–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ)</p>
            <p>‚Ä¢ –ú–æ–Ω—Å—Ç—Ä—ã —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –±—ã—Å—Ç—Ä–µ–µ –∏ —Å–∏–ª—å–Ω–µ–µ —Å –∫–∞–∂–¥–æ–π –≤–æ–ª–Ω–æ–π</p>
            <p>‚Ä¢ –ú–æ–Ω—Å—Ç—Ä—ã –º–æ–≥—É—Ç —Ö–æ–¥–∏—Ç—å —Å–∫–≤–æ–∑—å —Å—Ç–µ–Ω—ã!</p>
            <p>‚Ä¢ –ò–≥—Ä–æ–∫ –ù–ï –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ —Å—Ç–µ–Ω—ã</p>
            <p><strong>–ù–∞–≥—Ä–∞–¥—ã:</strong></p>
            <p>‚Ä¢ –û–±—ã—á–Ω—ã–µ –º–æ–Ω—Å—Ç—Ä—ã: 5 –º–æ–Ω–µ—Ç</p>
            <p>‚Ä¢ –ë—ã—Å—Ç—Ä—ã–µ –º–æ–Ω—Å—Ç—Ä—ã: 5 –º–æ–Ω–µ—Ç</p>
            <p>‚Ä¢ –ë–æ—Å—Å: 50 –º–æ–Ω–µ—Ç</p>
            <p><strong>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –ü–ö:</strong></p>
            <p>W, A, S, D –∏–ª–∏ —Å—Ç—Ä–µ–ª–∫–∏ ‚Äî –¥–≤–∏–∂–µ–Ω–∏–µ</p>
            <p>–ü—Ä–∞–≤—ã–π –∫–ª–∏–∫ –º—ã—à–∏ ‚Äî –≤—ã—Å—Ç—Ä–µ–ª</p>
            <p>B ‚Äî –æ—Ç–∫—Ä—ã—Ç—å –º–∞–≥–∞–∑–∏–Ω</p>
            <p><strong>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ:</strong></p>
            <p>üïπÔ∏è –î–∂–æ–π—Å—Ç–∏–∫ ‚Äî –¥–≤–∏–∂–µ–Ω–∏–µ</p>
            <p>üíÄ –ö–Ω–æ–ø–∫–∞ ‚Äî –∞—Ç–∞–∫–∞</p>
            <p><strong>–ú–∞–≥–∞–∑–∏–Ω (B):</strong></p>
            <p>‚Ä¢ –û—Ä—É–∂–∏–µ ‚Äî —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —É—Ä–æ–Ω</p>
            <p>‚Ä¢ –°–∫–æ—Ä–æ—Å—Ç—å ‚Äî —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç—å –¥–≤–∏–∂–µ–Ω–∏—è</p>
            <p>‚Ä¢ –ó–¥–æ—Ä–æ–≤—å–µ ‚Äî —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ</p>
            <p>‚Ä¢ –ë–∞—Ñ—Ñ—ã ‚Äî –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —É—Å–∏–ª–µ–Ω–∏—è</p>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –æ–± –∏–≥—Ä–µ -->
    <div id="aboutScreen">
        <button class="back-button" onclick="showMenu()">‚Üê –ù–∞–∑–∞–¥</button>
        <div class="content-box">
            <h2>üå≤ –û–± –∏–≥—Ä–µ</h2>
            <p><strong>–°–¢–†–ê–®–ù–´–ô –õ–ï–°</strong></p>
            <p>2D-–∏–≥—Ä–∞ —Å–≤–µ—Ä—Ö—É –≤ —Å—Ç–∏–ª–µ survival —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ roguelike.</p>
            <p>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:</p>
            <p>‚Ä¢ –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–µ—Ç –≤–º–µ—Å—Ç–æ –æ–ø—ã—Ç–∞</p>
            <p>‚Ä¢ –ú–∞–≥–∞–∑–∏–Ω —Å –æ—Ä—É–∂–∏–µ–º –∏ –±–∞—Ñ—Ñ–∞–º–∏</p>
            <p>‚Ä¢ –ú–æ–Ω—Å—Ç—Ä—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —Å–∫–≤–æ–∑—å —Å—Ç–µ–Ω—ã</p>
            <p>‚Ä¢ –ò–≥—Ä–æ–∫ –ù–ï –ø—Ä–æ—Ö–æ–¥–∏—Ç —Å–∫–≤–æ–∑—å —Å—Ç–µ–Ω—ã</p>
            <p>‚Ä¢ –ë–æ—Å—Å—ã –∫–∞–∂–¥—ã–µ 5 –≤–æ–ª–Ω (—Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è —Å–∏–ª—å–Ω–µ–µ)</p>
            <p>‚Ä¢ –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ —Å –∫–∞–∂–¥–æ–π –≤–æ–ª–Ω–æ–π</p>
            <p>‚Ä¢ –°–µ—Ä—ã–π —Å—Ç–∏–ª—å –º–∏–Ω–∏–∫–∞—Ä—Ç—ã</p>
            <p><strong>–í—ã–∂–∏–≤–∏ –∫–∞–∫ –º–æ–∂–Ω–æ –¥–æ–ª—å—à–µ –∏ —Å—Ç–∞–Ω—å –±–æ–≥–∞—á–µ!</strong></p>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –∏–≥—Ä—ã -->
    <div id="gameScreen">
        <canvas id="gameCanvas"></canvas>

        <div class="ui-panel">
            <div>‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ: <span id="healthText">100</span>/<span id="maxHealthText">100</span></div>
            <div>‚è±Ô∏è –í—Ä–µ–º—è: <span id="timeText">0</span>—Å</div>
            <div>üíÄ –í–æ–ª–Ω–∞: <span id="waveText">1</span></div>
            <div>üéØ –£—Ä–æ–Ω: <span id="damageText">20</span></div>
            <div>üèÉ –°–∫–æ—Ä–æ—Å—Ç—å: <span id="speedText">220</span></div>
            <div>üî´ –û—Ä—É–∂–∏–µ: <span id="weaponText">–ë–∞–∑–æ–≤–∞—è</span></div>
        </div>

        <div class="coin-panel">
            <div>üí∞ –ú–æ–Ω–µ—Ç—ã: <span id="coinText">0</span></div>
            <div>üì¶ –ú–∞–≥–∞–∑–∏–Ω: B</div>
        </div>

        <canvas id="minimapCanvas" class="minimap" width="150" height="150"></canvas>

        <!-- –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –¥–∂–æ–π—Å—Ç–∏–∫ -->
        <div class="joystick-container" id="joystickContainer">
            <div class="joystick-base">
                <div class="joystick-stick" id="joystickStick"></div>
            </div>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∞ –∞—Ç–∞–∫–∏ -->
        <div class="attack-button" id="attackButton">üíÄ</div>
    </div>

    <!-- –ú–∞–≥–∞–∑–∏–Ω -->
    <div id="shopScreen">
        <div class="shop-container">
            <div class="shop-header">
                <h2 class="shop-title">üè™ –ú–ê–ì–ê–ó–ò–ù</h2>
                <div class="shop-coin">üí∞ <span id="shopCoinText">0</span></div>
            </div>
            <button class="back-button" onclick="closeShop()">‚Üê –ù–∞–∑–∞–¥ –≤ –∏–≥—Ä—É</button>
            
            <div class="shop-items">
                <!-- –û—Ä—É–∂–∏–µ -->
                <div class="shop-item" onclick="buyItem('pistol')" id="pistolItem">
                    <div class="item-header">
                        <div class="item-name">üî´ –ü–∏—Å—Ç–æ–ª–µ—Ç</div>
                        <div class="item-price">50üí∞</div>
                    </div>
                    <div class="item-description">–ë–∞–∑–æ–≤–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å, —Å—Ä–µ–¥–Ω–∏–π —É—Ä–æ–Ω</div>
                    <div class="item-stats">–£—Ä–æ–Ω: 25 | –°–∫–æ—Ä–æ—Å—Ç—Ä–µ–ª—å–Ω–æ—Å—Ç—å: 0.4—Å</div>
                </div>

                <div class="shop-item" onclick="buyItem('shotgun')" id="shotgunItem">
                    <div class="item-header">
                        <div class="item-name">üî´ –î—Ä–æ–±–æ–≤–∏–∫</div>
                        <div class="item-price">120üí∞</div>
                    </div>
                    <div class="item-description">–†–∞–∑–±—Ä–æ—Å–Ω—ã–π –≤—ã—Å—Ç—Ä–µ–ª, –≤—ã—Å–æ–∫–∏–π —É—Ä–æ–Ω –≤–±–ª–∏–∑–∏</div>
                    <div class="item-stats">–£—Ä–æ–Ω: 40 (x3) | –°–∫–æ—Ä–æ—Å—Ç—Ä–µ–ª—å–Ω–æ—Å—Ç—å: 0.8—Å</div>
                </div>

                <div class="shop-item" onclick="buyItem('machinegun')" id="machinegunItem">
                    <div class="item-header">
                        <div class="item-name">üî´ –ü—É–ª–µ–º—ë—Ç</div>
                        <div class="item-price">200üí∞</div>
                    </div>
                    <div class="item-description">–ë—ã—Å—Ç—Ä–∞—è —Å—Ç—Ä–µ–ª—å–±–∞, –Ω–∏–∑–∫–∏–π —É—Ä–æ–Ω –∑–∞ –≤—ã—Å—Ç—Ä–µ–ª</div>
                    <div class="item-stats">–£—Ä–æ–Ω: 15 | –°–∫–æ—Ä–æ—Å—Ç—Ä–µ–ª—å–Ω–æ—Å—Ç—å: 0.15—Å</div>
                </div>

                <!-- –£–ª—É—á—à–µ–Ω–∏—è -->
                <div class="shop-item" onclick="buyItem('speed')" id="speedItem">
                    <div class="item-header">
                        <div class="item-name">üèÉ –°–∫–æ—Ä–æ—Å—Ç—å</div>
                        <div class="item-price">80üí∞</div>
                    </div>
                    <div class="item-description">–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç—å –¥–≤–∏–∂–µ–Ω–∏—è</div>
                    <div class="item-stats">+20% —Å–∫–æ—Ä–æ—Å—Ç–∏</div>
                </div>

                <div class="shop-item" onclick="buyItem('health')" id="healthItem">
                    <div class="item-header">
                        <div class="item-name">‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ</div>
                        <div class="item-price">100üí∞</div>
                    </div>
                    <div class="item-description">–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ</div>
                    <div class="item-stats">+50 –∑–¥–æ—Ä–æ–≤—å—è</div>
                </div>

                <div class="shop-item" onclick="buyItem('regen')" id="regenItem">
                    <div class="item-header">
                        <div class="item-name">üîÑ –†–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è</div>
                        <div class="item-price">150üí∞</div>
                    </div>
                    <div class="item-description">–ú–µ–¥–ª–µ–Ω–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–¥–æ—Ä–æ–≤—å–µ</div>
                    <div class="item-stats">+5 HP/—Å–µ–∫</div>
                </div>

                <!-- –ë–∞—Ñ—Ñ—ã -->
                <div class="shop-item" onclick="buyItem('damageBuff')" id="damageBuffItem">
                    <div class="item-header">
                        <div class="item-name">‚ö° –£—Ä–æ–Ω+</div>
                        <div class="item-price">60üí∞</div>
                    </div>
                    <div class="item-description">–í—Ä–µ–º–µ–Ω–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —É—Ä–æ–Ω –Ω–∞ 50%</div>
                    <div class="item-stats">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 30 —Å–µ–∫</div>
                </div>

                <div class="shop-item" onclick="buyItem('speedBuff')" id="speedBuffItem">
                    <div class="item-header">
                        <div class="item-name">‚ö° –°–∫–æ—Ä–æ—Å—Ç—å+</div>
                        <div class="item-price">60üí∞</div>
                    </div>
                    <div class="item-description">–í—Ä–µ–º–µ–Ω–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç—å –Ω–∞ 40%</div>
                    <div class="item-stats">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 30 —Å–µ–∫</div>
                </div>
            </div>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è -->
    <div class="game-over-screen" id="gameOverScreen">
        <h1 id="gameOverTitle">–í–´ –ü–†–û–ò–ì–†–ê–õ–ò!</h1>
        <p>‚è±Ô∏è –í—Ä–µ–º—è –≤—ã–∂–∏–≤–∞–Ω–∏—è: <span id="finalTime">0</span>—Å</p>
        <p>üíÄ –î–æ—Å—Ç–∏–≥–Ω—É—Ç–∞—è –≤–æ–ª–Ω–∞: <span id="finalWave">1</span></p>
        <p>üí∞ –°–æ–±—Ä–∞–Ω–æ –º–æ–Ω–µ—Ç: <span id="finalCoins">0</span></p>
        <p>üî´ –û—Ä—É–∂–∏–µ: <span id="finalWeapon">–ë–∞–∑–æ–≤–∞—è</span></p>
        <button class="menu-button" style="margin-top: 20px;" onclick="showMenu()">–í –º–µ–Ω—é</button>
    </div>

    <script>
        // ---------- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ ----------
        const isTouchDevice = ("ontouchstart" in window) || (navigator.maxTouchPoints > 0);

        // ---------- –†–∞–±–æ—Ç–∞ –∑–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ ----------
        window.addEventListener("load", () => {
            const loadingScreen = document.getElementById("loadingScreen");
            const loadingTitle = document.getElementById("loadingTitle");

            const text = loadingTitle.textContent;
            loadingTitle.textContent = "";
            for (let i = 0; i < text.length; i++) {
                const span = document.createElement("span");
                span.textContent = text[i];
                span.style.animationDelay = (i * 0.08) + "s";
                loadingTitle.appendChild(span);
            }

            function proceed() {
                loadingScreen.classList.add("fade-out");
                setTimeout(() => {
                    loadingScreen.style.display = "none";
                    showMenu();
                }, 500);
            }

            loadingScreen.addEventListener("click", proceed);
            loadingScreen.addEventListener("touchstart", (e) => {
                e.preventDefault();
                proceed();
            }, { passive: false });

            document.addEventListener("keydown", (e) => {
                if (e.key === "Enter" || e.key === " ") {
                    proceed();
                }
            });
        });

        // ---------- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —ç–∫—Ä–∞–Ω–∞–º ----------
        function hideAllScreens() {
            document.getElementById("menuScreen").style.display = "none";
            document.getElementById("gameScreen").style.display = "none";
            document.getElementById("instructionsScreen").style.display = "none";
            document.getElementById("aboutScreen").style.display = "none";
            document.getElementById("shopScreen").style.display = "none";
            document.getElementById("gameOverScreen").style.display = "none";
        }

        function showMenu() {
            hideAllScreens();
            document.getElementById("menuScreen").style.display = "flex";
            gameRunning = false;
        }

        function showInstructions() {
            hideAllScreens();
            document.getElementById("instructionsScreen").style.display = "flex";
        }

        function showAbout() {
            hideAllScreens();
            document.getElementById("aboutScreen").style.display = "flex";
        }

        function openShop() {
            if (!gameRunning) return;
            gameRunning = false;
            hideAllScreens();
            document.getElementById("shopScreen").style.display = "flex";
            document.getElementById("shopCoinText").textContent = player.coins;
            updateShopItems();
        }

        function closeShop() {
            hideAllScreens();
            document.getElementById("gameScreen").style.display = "block";
            gameRunning = true;
            lastFrameTs = performance.now();
            requestAnimationFrame(gameLoop);
        }

        function startGame() {
            hideAllScreens();
            document.getElementById("gameScreen").style.display = "block";
            initGame();
        }

        // ---------- Canvas –∏ –º–∏–Ω–∏–∫–∞—Ä—Ç–∞ ----------
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const minimapCanvas = document.getElementById("minimapCanvas");
        const minimapCtx = minimapCanvas.getContext("2d");

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resizeCanvas();
        window.addEventListener("resize", resizeCanvas);

        function resizeMinimap() {
            const w = window.innerWidth;
            const size = w > 1000 ? 220 : w > 700 ? 180 : 150;
            minimapCanvas.width = size;
            minimapCanvas.height = size;
            minimapCanvas.style.width = size + "px";
            minimapCanvas.style.height = size + "px";
        }
        resizeMinimap();
        window.addEventListener("resize", resizeMinimap);

        // ---------- –ò–≥—Ä–æ–≤—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã ----------
        const WORLD_WIDTH = 3200;
        const WORLD_HEIGHT = 3200;
        const TILE_SIZE = 64;

        // ---------- –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ ----------
        const keys = {};
        window.addEventListener("keydown", (e) => {
            keys[e.code] = true;
            if (e.code === "KeyB") {
                openShop();
            }
        });
        window.addEventListener("keyup", (e) => {
            keys[e.code] = false;
        });

        // ---------- –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–∞–≤–æ–π –∫–Ω–æ–ø–∫–∏ –º—ã—à–∏ ----------
        canvas.addEventListener('contextmenu', (e) => {
            e.preventDefault();
            return false;
        });

        let rightMouseDown = false;
        canvas.addEventListener('mousedown', (e) => {
            if (e.button === 2) {
                rightMouseDown = true;
                e.preventDefault();
            }
        });
        canvas.addEventListener('mouseup', (e) => {
            if (e.button === 2) {
                rightMouseDown = false;
                e.preventDefault();
            }
        });

        // ---------- –î–∂–æ–π—Å—Ç–∏–∫ ----------
        const joystickVector = { x: 0, y: 0 };
        let joystickActive = false;

        if (isTouchDevice) {
            const jc = document.getElementById("joystickContainer");
            const jb = jc.querySelector(".joystick-base");
            const js = document.getElementById("joystickStick");
            const maxDistance = 40;
            let startX = 0, startY = 0;

            jc.style.display = "block";
            document.getElementById("attackButton").style.display = "flex";

            jc.addEventListener("touchstart", (e) => {
                e.preventDefault();
                const rect = jb.getBoundingClientRect();
                startX = rect.left + rect.width / 2;
                startY = rect.top + rect.height / 2;
                joystickActive = true;
            }, { passive: false });

            document.addEventListener("touchmove", (e) => {
                if (!joystickActive) return;
                e.preventDefault();
                const t = e.touches[0];
                let dx = t.clientX - startX;
                let dy = t.clientY - startY;
                const dist = Math.sqrt(dx * dx + dy * dy) || 1;
                if (dist > maxDistance) {
                    dx = dx / dist * maxDistance;
                    dy = dy / dist * maxDistance;
                }
                js.style.transform = `translate(calc(-50% + ${dx}px), calc(-50% + ${dy}px))`;
                joystickVector.x = dx / maxDistance;
                joystickVector.y = dy / maxDistance;
            }, { passive: false });

            document.addEventListener("touchend", (e) => {
                if (!joystickActive) return;
                e.preventDefault();
                joystickActive = false;
                js.style.transform = "translate(-50%, -50%)";
                joystickVector.x = 0;
                joystickVector.y = 0;
            }, { passive: false });

            const attackButton = document.getElementById("attackButton");
            attackButton.addEventListener("touchstart", (e) => {
                e.preventDefault();
                keys["Space"] = true;
                if (navigator.vibrate) navigator.vibrate(40);
            }, { passive: false });
            attackButton.addEventListener("touchend", (e) => {
                e.preventDefault();
                keys["Space"] = false;
            }, { passive: false });
        }

        // ---------- –ö–ª–∞—Å—Å—ã –æ–±—ä–µ–∫—Ç–æ–≤ ----------
        class Player {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.size = 20;
                this.baseSpeed = 220;
                this.speed = 220;
                this.maxHealth = 100;
                this.health = this.maxHealth;
                this.coins = 0;
                this.weapon = 'basic';
                this.weaponDamage = 20;
                this.shootCooldown = 0.4;
                this.buffs = [];
                this.regenRate = 0;
                this.level = 1;
            }

            update(dt) {
                let dx = 0, dy = 0;

                if (!isTouchDevice) {
                    if (keys["KeyW"] || keys["ArrowUp"]) dy -= 1;
                    if (keys["KeyS"] || keys["ArrowDown"]) dy += 1;
                    if (keys["KeyA"] || keys["ArrowLeft"]) dx -= 1;
                    if (keys["KeyD"] || keys["ArrowRight"]) dx += 1;
                } else {
                    dx = joystickVector.x;
                    dy = joystickVector.y;
                }

                if (dx !== 0 || dy !== 0) {
                    const len = Math.hypot(dx, dy);
                    dx /= len;
                    dy /= len;
                }

                const step = this.speed * dt;
                let nx = this.x + dx * step;
                let ny = this.y + dy * step;

                // –ò–≥—Ä–æ–∫ –ù–ï –ø—Ä–æ—Ö–æ–¥–∏—Ç —Å–∫–≤–æ–∑—å —Å—Ç–µ–Ω—ã - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π
                if (!checkCollisionCircle(nx, this.y, this.size)) {
                    this.x = nx;
                }
                if (!checkCollisionCircle(this.x, ny, this.size)) {
                    this.y = ny;
                }

                this.x = clamp(this.x, this.size, WORLD_WIDTH - this.size);
                this.y = clamp(this.y, this.size, WORLD_HEIGHT - this.size);

                // –†–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–¥–æ—Ä–æ–≤—å—è
                if (this.regenRate > 0 && this.health < this.maxHealth) {
                    this.health = Math.min(this.maxHealth, this.health + this.regenRate * dt);
                }

                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞—Ñ—Ñ–æ–≤
                for (let i = this.buffs.length - 1; i >= 0; i--) {
                    const buff = this.buffs[i];
                    buff.duration -= dt;
                    if (buff.duration <= 0) {
                        this.removeBuff(buff.type);
                        this.buffs.splice(i, 1);
                    }
                }
            }

            applyBuff(type, duration) {
                this.buffs.push({ type, duration });
                
                switch(type) {
                    case 'damage':
                        this.weaponDamage *= 1.5;
                        break;
                    case 'speed':
                        this.speed *= 1.4;
                        break;
                }
                
                setTimeout(() => {
                    this.removeBuff(type);
                }, duration * 1000);
            }

            removeBuff(type) {
                switch(type) {
                    case 'damage':
                        this.weaponDamage /= 1.5;
                        break;
                    case 'speed':
                        this.speed /= 1.4;
                        break;
                }
            }

            draw(camera) {
                const sx = Math.floor(this.x - camera.x);
                const sy = Math.floor(this.y - camera.y);

                // —Ç–µ–Ω—å
                ctx.fillStyle = "rgba(0,0,0,0.5)";
                ctx.beginPath();
                ctx.ellipse(sx, sy + this.size, this.size * 0.75, this.size * 0.3, 0, 0, Math.PI * 2);
                ctx.fill();

                // —Ç–µ–ª–æ
                ctx.fillStyle = "#3b82f6";
                ctx.beginPath();
                ctx.arc(sx, sy, this.size, 0, Math.PI * 2);
                ctx.fill();

                // –≥–ª–∞–∑–∞
                ctx.fillStyle = "#ffffff";
                ctx.fillRect(sx - 4, sy - 2, 2, 4);
                ctx.fillRect(sx + 2, sy - 2, 2, 4);

                // –æ—Ä—É–∂–∏–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
                ctx.strokeStyle = "#ffffff";
                ctx.lineWidth = 3;
                ctx.beginPath();
                
                switch(this.weapon) {
                    case 'pistol':
                        ctx.moveTo(sx + 15, sy);
                        ctx.lineTo(sx + 25, sy);
                        break;
                    case 'shotgun':
                        ctx.moveTo(sx + 15, sy - 3);
                        ctx.lineTo(sx + 30, sy - 10);
                        ctx.moveTo(sx + 15, sy);
                        ctx.lineTo(sx + 30, sy);
                        ctx.moveTo(sx + 15, sy + 3);
                        ctx.lineTo(sx + 30, sy + 10);
                        break;
                    case 'machinegun':
                        ctx.moveTo(sx + 15, sy - 2);
                        ctx.lineTo(sx + 30, sy - 5);
                        ctx.moveTo(sx + 15, sy);
                        ctx.lineTo(sx + 30, sy);
                        ctx.moveTo(sx + 15, sy + 2);
                        ctx.lineTo(sx + 30, sy + 5);
                        break;
                    default:
                        ctx.moveTo(sx + 15, sy);
                        ctx.lineTo(sx + 25, sy);
                }
                ctx.stroke();
            }

            addCoins(amount) {
                this.coins += amount;
                document.getElementById("coinText").textContent = this.coins;
            }
        }

        class Enemy {
            constructor(x, y, wave) {
                this.x = x;
                this.y = y;
                this.size = 16 + wave * 0.2;
                this.baseSpeed = 120 + wave * 2;
                this.speed = 120 + wave * 2;
                this.health = 20 + wave * 3;
                this.maxHealth = this.health;
                this.type = "normal";
                this.wave = wave;
            }

            update(dt) {
                const dx = player.x - this.x;
                const dy = player.y - this.y;
                const dist = Math.hypot(dx, dy) || 1;
                const vx = (dx / dist) * this.speed * dt;
                const vy = (dy / dist) * this.speed * dt;

                // –ú–æ–Ω—Å—Ç—Ä—ã —Ö–æ–¥—è—Ç —Å–∫–≤–æ–∑—å —Å—Ç–µ–Ω—ã - —É–±—Ä–∞–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π
                this.x += vx;
                this.y += vy;

                const dToPlayer = Math.hypot(player.x - this.x, player.y - this.y);
                if (dToPlayer < this.size + player.size) {
                    if (player.health > 0) {
                        player.health -= (20 + this.wave * 0.5) * dt;
                        if (player.health < 0) player.health = 0;
                    }
                }
            }

            draw(camera) {
                const sx = this.x - camera.x;
                const sy = this.y - camera.y;

                ctx.fillStyle = "#111827";
                ctx.beginPath();
                ctx.arc(sx, sy, this.size + 3, 0, Math.PI * 2);
                ctx.fill();

                ctx.fillStyle = "#dc2626";
                ctx.beginPath();
                ctx.arc(sx, sy, this.size, 0, Math.PI * 2);
                ctx.fill();

                // –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–¥–æ—Ä–æ–≤—å—è
                const healthPercent = this.health / this.maxHealth;
                ctx.fillStyle = "#22c55e";
                ctx.fillRect(sx - this.size, sy - this.size - 5, this.size * 2 * healthPercent, 3);

                ctx.fillStyle = "#fee2e2";
                ctx.fillRect(sx - 6, sy - 3, 4, 3);
                ctx.fillRect(sx + 2, sy - 3, 4, 3);
            }
        }

        class FastEnemy {
            constructor(x, y, wave) {
                this.x = x;
                this.y = y;
                this.size = 14 + wave * 0.15;
                this.baseSpeed = 180 + wave * 3;
                this.speed = 180 + wave * 3;
                this.health = 15 + wave * 2;
                this.maxHealth = this.health;
                this.type = "fast";
                this.wave = wave;
            }

            update(dt) {
                const dx = player.x - this.x;
                const dy = player.y - this.y;
                const dist = Math.hypot(dx, dy) || 1;
                const vx = (dx / dist) * this.speed * dt;
                const vy = (dy / dist) * this.speed * dt;

                // –ú–æ–Ω—Å—Ç—Ä—ã —Ö–æ–¥—è—Ç —Å–∫–≤–æ–∑—å —Å—Ç–µ–Ω—ã
                this.x += vx;
                this.y += vy;

                const dToPlayer = Math.hypot(player.x - this.x, player.y - this.y);
                if (dToPlayer < this.size + player.size) {
                    if (player.health > 0) {
                        player.health -= (15 + this.wave * 0.4) * dt;
                        if (player.health < 0) player.health = 0;
                    }
                }
            }

            draw(camera) {
                const sx = this.x - camera.x;
                const sy = this.y - camera.y;

                ctx.fillStyle = "#0c4a6e";
                ctx.beginPath();
                ctx.arc(sx, sy, this.size + 3, 0, Math.PI * 2);
                ctx.fill();

                ctx.fillStyle = "#3b82f6";
                ctx.beginPath();
                ctx.arc(sx, sy, this.size, 0, Math.PI * 2);
                ctx.fill();

                // –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–¥–æ—Ä–æ–≤—å—è
                const healthPercent = this.health / this.maxHealth;
                ctx.fillStyle = "#22c55e";
                ctx.fillRect(sx - this.size, sy - this.size - 5, this.size * 2 * healthPercent, 3);

                ctx.fillStyle = "#ffffff";
                ctx.fillRect(sx - 5, sy - 3, 3, 2);
                ctx.fillRect(sx + 2, sy - 3, 3, 2);
                
                ctx.strokeStyle = "#ffffff";
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(sx - 3, sy + 3);
                ctx.lineTo(sx + 3, sy + 3);
                ctx.stroke();
            }
        }

        class BossEnemy {
            constructor(x, y, wave) {
                this.x = x;
                this.y = y;
                this.bossLevel = Math.floor(wave / 5);
                this.size = 35 + this.bossLevel * 5;
                this.speed = 100 + this.bossLevel * 5;
                this.health = 300 + this.bossLevel * 100;
                this.maxHealth = this.health;
                this.damage = 50 + this.bossLevel * 10;
                this.type = "boss";
                this.wave = wave;
                this.pulse = 0;
                this.lastAttackTime = 0;
                this.attackCooldown = 2 - this.bossLevel * 0.1;
            }

            update(dt) {
                this.pulse += dt * 3;
                
                const dx = player.x - this.x;
                const dy = player.y - this.y;
                const dist = Math.hypot(dx, dy) || 1;
                const vx = (dx / dist) * this.speed * dt;
                const vy = (dy / dist) * this.speed * dt;

                // –ë–æ—Å—Å —Ö–æ–¥–∏—Ç —Å–∫–≤–æ–∑—å —Å—Ç–µ–Ω—ã
                this.x += vx;
                this.y += vy;

                // –ê—Ç–∞–∫–∞ –∏–≥—Ä–æ–∫–∞
                const dToPlayer = Math.hypot(player.x - this.x, player.y - this.y);
                const currentTime = gameTime;
                
                if (dToPlayer < this.size + player.size + 10) {
                    if (currentTime - this.lastAttackTime > this.attackCooldown) {
                        player.health -= this.damage;
                        this.lastAttackTime = currentTime;
                        if (navigator.vibrate) navigator.vibrate(200);
                    }
                }
            }

            draw(camera) {
                const sx = this.x - camera.x;
                const sy = this.y - camera.y;
                const pulseSize = Math.sin(this.pulse) * 5;

                // –ê—É—Ä–∞ –±–æ—Å—Å–∞
                ctx.fillStyle = "rgba(139, 0, 0, 0.2)";
                ctx.beginPath();
                ctx.arc(sx, sy, this.size + 15 + pulseSize, 0, Math.PI * 2);
                ctx.fill();

                // –¢–µ–ª–æ –±–æ—Å—Å–∞
                ctx.fillStyle = "#8b0000";
                ctx.beginPath();
                ctx.arc(sx, sy, this.size + pulseSize, 0, Math.PI * 2);
                ctx.fill();

                // –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–¥–æ—Ä–æ–≤—å—è
                const healthPercent = this.health / this.maxHealth;
                ctx.fillStyle = "#22c55e";
                ctx.fillRect(sx - this.size - 10, sy - this.size - 15, (this.size + 10) * 2 * healthPercent, 8);
                ctx.strokeStyle = "#ffffff";
                ctx.lineWidth = 2;
                ctx.strokeRect(sx - this.size - 10, sy - this.size - 15, (this.size + 10) * 2, 8);

                // –ì–ª–∞–∑–∞
                ctx.fillStyle = "#ff0000";
                ctx.beginPath();
                ctx.arc(sx - 10, sy - 5, 8, 0, Math.PI * 2);
                ctx.fill();
                ctx.beginPath();
                ctx.arc(sx + 10, sy - 5, 8, 0, Math.PI * 2);
                ctx.fill();

                // –†–æ—Ç
                ctx.fillStyle = "#000000";
                ctx.beginPath();
                ctx.arc(sx, sy + 10, 12, 0, Math.PI, false);
                ctx.fill();

                // –¢–µ–∫—Å—Ç —É—Ä–æ–≤–Ω—è –±–æ—Å—Å–∞
                ctx.fillStyle = "#ffffff";
                ctx.font = "bold 16px Arial";
                ctx.textAlign = "center";
                ctx.fillText(`–ë–û–°–° ${this.bossLevel}`, sx, sy - this.size - 25);
                ctx.textAlign = "left";
            }
        }

        class Projectile {
            constructor(x, y, dx, dy, damage, type = 'basic') {
                this.x = x;
                this.y = y;
                this.dx = dx;
                this.dy = dy;
                this.speed = 520;
                this.size = type === 'shotgun' ? 8 : 5;
                this.life = type === 'shotgun' ? 0.5 : 0.8;
                this.damage = damage;
                this.type = type;
            }

            update(dt) {
                this.x += this.dx * this.speed * dt;
                this.y += this.dy * this.speed * dt;
                this.life -= dt;
            }

            draw(camera) {
                const sx = this.x - camera.x;
                const sy = this.y - camera.y;

                if (this.type === 'shotgun') {
                    ctx.fillStyle = "#ff6b00";
                } else if (this.type === 'machinegun') {
                    ctx.fillStyle = "#00ff88";
                } else {
                    ctx.fillStyle = "#fbbf24";
                }
                
                ctx.beginPath();
                ctx.arc(sx, sy, this.size, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = `rgba(251, 191, 36, 0.3)`;
                ctx.beginPath();
                ctx.arc(sx, sy, this.size * 2, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        class Coin {
            constructor(x, y, value) {
                this.x = x;
                this.y = y;
                this.size = 8;
                this.value = value;
                this.float = Math.random() * Math.PI * 2;
            }

            update(dt) {
                this.float += dt * 3;
            }

            draw(camera) {
                const sx = this.x - camera.x;
                const sy = this.y - camera.y + Math.sin(this.float) * 3;

                ctx.fillStyle = "#fbbf24";
                ctx.beginPath();
                ctx.arc(sx, sy, this.size, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = "#92400e";
                ctx.beginPath();
                ctx.arc(sx, sy, this.size * 0.6, 0, Math.PI * 2);
                ctx.fill();
                
                // –ë–ª–µ—Å–∫
                ctx.fillStyle = "#ffffff";
                ctx.beginPath();
                ctx.arc(sx - 3, sy - 3, this.size * 0.3, 0, Math.PI * 2);
                ctx.fill();
                
                // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è –±–æ—Å—Å–æ–≤—ã—Ö –º–æ–Ω–µ—Ç)
                if (this.value > 10) {
                    ctx.fillStyle = "#ffffff";
                    ctx.font = "bold 10px Arial";
                    ctx.textAlign = "center";
                    ctx.fillText(this.value, sx, sy + 15);
                    ctx.textAlign = "left";
                }
            }
        }

        class HealthPickup {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.size = 10;
                this.float = Math.random() * Math.PI * 2;
            }

            draw(camera) {
                const sx = this.x - camera.x;
                const sy = this.y - camera.y + Math.sin(this.float) * 3;

                ctx.fillStyle = "#dc2626";
                ctx.fillRect(sx - 8, sy - 4, 16, 8);
                ctx.fillStyle = "#ffffff";
                ctx.fillRect(sx - 4, sy - 8, 8, 4);
                ctx.fillRect(sx - 1, sy - 11, 2, 3);
            }
        }

        // ---------- –û–±—ä–µ–∫—Ç—ã –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ ----------
        let player;
        let enemies = [];
        let projectiles = [];
        let coins = [];
        let healthPickups = [];
        let obstacles = [];
        let camera = { x: 0, y: 0 };
        let wave = 1;
        let enemiesPerWave = 6;
        let shootTimer = 0;
        let gameTime = 0;
        let lastFrameTs = performance.now();
        let gameRunning = false;
        let currentBoss = null;

        // ---------- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ ----------
        function clamp(v, min, max) { return v < min ? min : v > max ? max : v; }

        function randRange(min, max) {
            return Math.random() * (max - min) + min;
        }

        function generateObstacles() {
            obstacles = [];
            const count = 200;
            for (let i = 0; i < count; i++) {
                const x = randRange(80, WORLD_WIDTH - 80);
                const y = randRange(80, WORLD_HEIGHT - 80);
                const r = randRange(20, 40);
                const type = Math.random() > 0.5 ? "tree" : "rock";
                obstacles.push({ x, y, r, type });
            }
        }

        function checkCollisionCircle(x, y, r) {
            for (const o of obstacles) {
                const d = Math.hypot(o.x - x, o.y - y);
                if (d < o.r + r) return true;
            }
            return false;
        }

        // ---------- –ú–∞–≥–∞–∑–∏–Ω ----------
        function updateShopItems() {
            const items = [
                { id: 'pistol', price: 50, owned: player.weapon === 'pistol' },
                { id: 'shotgun', price: 120, owned: player.weapon === 'shotgun' },
                { id: 'machinegun', price: 200, owned: player.weapon === 'machinegun' },
                { id: 'speed', price: 80 },
                { id: 'health', price: 100 },
                { id: 'regen', price: 150 },
                { id: 'damageBuff', price: 60 },
                { id: 'speedBuff', price: 60 }
            ];

            items.forEach(item => {
                const element = document.getElementById(item.id + 'Item');
                if (element) {
                    if (item.owned) {
                        element.classList.add('disabled');
                        element.innerHTML += '<div style="color:#22c55e;font-size:12px;margin-top:5px;">‚úì –£–ñ–ï –ö–£–ü–õ–ï–ù–û</div>';
                    } else if (player.coins < item.price) {
                        element.classList.add('disabled');
                    } else {
                        element.classList.remove('disabled');
                    }
                }
            });
        }

        function buyItem(itemType) {
            const itemElement = document.getElementById(itemType + 'Item');
            if (itemElement.classList.contains('disabled')) return;

            let price = 0;
            let success = false;

            switch(itemType) {
                case 'pistol':
                    price = 50;
                    if (player.coins >= price && player.weapon !== 'pistol') {
                        player.coins -= price;
                        player.weapon = 'pistol';
                        player.weaponDamage = 25;
                        player.shootCooldown = 0.4;
                        success = true;
                    }
                    break;
                    
                case 'shotgun':
                    price = 120;
                    if (player.coins >= price && player.weapon !== 'shotgun') {
                        player.coins -= price;
                        player.weapon = 'shotgun';
                        player.weaponDamage = 40;
                        player.shootCooldown = 0.8;
                        success = true;
                    }
                    break;
                    
                case 'machinegun':
                    price = 200;
                    if (player.coins >= price && player.weapon !== 'machinegun') {
                        player.coins -= price;
                        player.weapon = 'machinegun';
                        player.weaponDamage = 15;
                        player.shootCooldown = 0.15;
                        success = true;
                    }
                    break;
                    
                case 'speed':
                    price = 80;
                    if (player.coins >= price) {
                        player.coins -= price;
                        player.speed = player.baseSpeed * 1.2;
                        success = true;
                    }
                    break;
                    
                case 'health':
                    price = 100;
                    if (player.coins >= price) {
                        player.coins -= price;
                        player.maxHealth += 50;
                        player.health += 50;
                        success = true;
                    }
                    break;
                    
                case 'regen':
                    price = 150;
                    if (player.coins >= price) {
                        player.coins -= price;
                        player.regenRate += 5;
                        success = true;
                    }
                    break;
                    
                case 'damageBuff':
                    price = 60;
                    if (player.coins >= price) {
                        player.coins -= price;
                        player.applyBuff('damage', 30);
                        success = true;
                    }
                    break;
                    
                case 'speedBuff':
                    price = 60;
                    if (player.coins >= price) {
                        player.coins -= price;
                        player.applyBuff('speed', 30);
                        success = true;
                    }
                    break;
            }

            if (success) {
                document.getElementById("coinText").textContent = player.coins;
                document.getElementById("shopCoinText").textContent = player.coins;
                updateUI();
                updateShopItems();
                if (navigator.vibrate) navigator.vibrate(50);
            }
        }

        function updateUI() {
            document.getElementById("healthText").textContent = Math.floor(player.health);
            document.getElementById("maxHealthText").textContent = player.maxHealth;
            document.getElementById("damageText").textContent = player.weaponDamage;
            document.getElementById("speedText").textContent = Math.floor(player.speed);
            
            let weaponName = "–ë–∞–∑–æ–≤–∞—è";
            switch(player.weapon) {
                case 'pistol': weaponName = "–ü–∏—Å—Ç–æ–ª–µ—Ç"; break;
                case 'shotgun': weaponName = "–î—Ä–æ–±–æ–≤–∏–∫"; break;
                case 'machinegun': weaponName = "–ü—É–ª–µ–º—ë—Ç"; break;
            }
            document.getElementById("weaponText").textContent = weaponName;
        }

        // ---------- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã ----------
        function initGame() {
            enemies = [];
            projectiles = [];
            coins = [];
            healthPickups = [];
            wave = 1;
            enemiesPerWave = 6;
            shootTimer = 0;
            gameTime = 0;
            currentBoss = null;
            
            generateObstacles();

            let px = WORLD_WIDTH / 2;
            let py = WORLD_HEIGHT / 2;
            while (checkCollisionCircle(px, py, 30)) {
                px = randRange(WORLD_WIDTH * 0.4, WORLD_WIDTH * 0.6);
                py = randRange(WORLD_HEIGHT * 0.4, WORLD_HEIGHT * 0.6);
            }
            
            player = new Player(px, py);
            updateUI();
            document.getElementById("coinText").textContent = player.coins;

            spawnWave();

            camera.x = player.x - canvas.width / 2;
            camera.y = player.y - canvas.height / 2;

            lastFrameTs = performance.now();
            gameRunning = true;
            requestAnimationFrame(gameLoop);
        }

        function spawnWave() {
            const ringMin = 400;
            const ringMax = 700;
            
            enemiesPerWave = Math.floor(enemiesPerWave * 1.1 + 1);
            
            // –°–ø–∞–≤–Ω –æ–±—ã—á–Ω—ã—Ö –≤—Ä–∞–≥–æ–≤
            for (let i = 0; i < enemiesPerWave; i++) {
                let x, y;
                const angle = Math.random() * Math.PI * 2;
                const dist = randRange(ringMin, ringMax);
                x = player.x + Math.cos(angle) * dist;
                y = player.y + Math.sin(angle) * dist;
                x = clamp(x, 60, WORLD_WIDTH - 60);
                y = clamp(y, 60, WORLD_HEIGHT - 60);
                
                enemies.push(new Enemy(x, y, wave));
            }
            
            // –°–ø–∞–≤–Ω –±—ã—Å—Ç—Ä—ã—Ö –≤—Ä–∞–≥–æ–≤ (—á–∞—â–µ —Å —Ä–æ—Å—Ç–æ–º –≤–æ–ª–Ω—ã)
            const fastCount = Math.floor(enemiesPerWave * (0.2 + wave * 0.02));
            for (let i = 0; i < fastCount; i++) {
                let x, y;
                const angle = Math.random() * Math.PI * 2;
                const dist = randRange(ringMin, ringMax);
                x = player.x + Math.cos(angle) * dist;
                y = player.y + Math.sin(angle) * dist;
                x = clamp(x, 60, WORLD_WIDTH - 60);
                y = clamp(y, 60, WORLD_HEIGHT - 60);
                
                enemies.push(new FastEnemy(x, y, wave));
            }
            
            // –°–ø–∞–≤–Ω –±–æ—Å—Å–∞ –∫–∞–∂–¥—ã–µ 5 –≤–æ–ª–Ω
            if (wave % 5 === 0) {
                let bx, by;
                const angle = Math.random() * Math.PI * 2;
                const dist = 600;
                bx = player.x + Math.cos(angle) * dist;
                by = player.y + Math.sin(angle) * dist;
                bx = clamp(bx, 100, WORLD_WIDTH - 100);
                by = clamp(by, 100, WORLD_HEIGHT - 100);
                
                currentBoss = new BossEnemy(bx, by, wave);
                enemies.push(currentBoss);
                
                // –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –±–æ—Å—Å–µ
                const warning = document.createElement("div");
                warning.style.position = "fixed";
                warning.style.top = "50%";
                warning.style.left = "50%";
                warning.style.transform = "translate(-50%, -50%)";
                warning.style.background = "rgba(0,0,0,0.9)";
                warning.style.color = "#8b0000";
                warning.style.padding = "20px";
                warning.style.borderRadius = "10px";
                warning.style.border = "3px solid #8b0000";
                warning.style.fontSize = "24px";
                warning.style.fontWeight = "bold";
                warning.style.zIndex = "100";
                warning.style.textAlign = "center";
                warning.innerHTML = `‚ö†Ô∏è –ü–û–Ø–í–ò–õ–°–Ø –ë–û–°–° ${Math.floor(wave/5)} –£–†–û–í–ù–Ø! ‚ö†Ô∏è`;
                document.body.appendChild(warning);
                
                setTimeout(() => {
                    if (warning.parentNode) {
                        document.body.removeChild(warning);
                    }
                }, 3000);
            }
            
            wave++;
            document.getElementById("waveText").textContent = wave - 1;
        }

        function shoot() {
            let projectilesToAdd = [];
            
            switch(player.weapon) {
                case 'basic':
                case 'pistol':
                    const dx1 = lastMousePos.x + camera.x - player.x;
                    const dy1 = lastMousePos.y + camera.y - player.y;
                    const len1 = Math.hypot(dx1, dy1) || 1;
                    projectilesToAdd.push(new Projectile(
                        player.x, player.y, 
                        dx1/len1, dy1/len1, 
                        player.weaponDamage,
                        player.weapon
                    ));
                    break;
                    
                case 'shotgun':
                    for (let i = -1; i <= 1; i++) {
                        const angle = Math.atan2(
                            lastMousePos.y + camera.y - player.y,
                            lastMousePos.x + camera.x - player.x
                        ) + i * 0.2;
                        projectilesToAdd.push(new Projectile(
                            player.x, player.y,
                            Math.cos(angle), Math.sin(angle),
                            player.weaponDamage,
                            'shotgun'
                        ));
                    }
                    break;
                    
                case 'machinegun':
                    const dx3 = lastMousePos.x + camera.x - player.x;
                    const dy3 = lastMousePos.y + camera.y - player.y;
                    const len3 = Math.hypot(dx3, dy3) || 1;
                    const spread = (Math.random() - 0.5) * 0.1;
                    const angle = Math.atan2(dy3, dx3) + spread;
                    projectilesToAdd.push(new Projectile(
                        player.x, player.y,
                        Math.cos(angle), Math.sin(angle),
                        player.weaponDamage,
                        'machinegun'
                    ));
                    break;
            }
            
            projectiles.push(...projectilesToAdd);
            if (navigator.vibrate) navigator.vibrate(30);
        }

        // ---------- –ú—ã—à—å (–¥–ª—è –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤—ã—Å—Ç—Ä–µ–ª–∞) ----------
        const lastMousePos = { x: 0, y: 0 };
        canvas.addEventListener("mousemove", (e) => {
            const rect = canvas.getBoundingClientRect();
            lastMousePos.x = e.clientX - rect.left;
            lastMousePos.y = e.clientY - rect.top;
        });

        // ---------- –ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª ----------
        function gameLoop(timestamp) {
            if (!gameRunning) return;

            const dt = Math.min((timestamp - lastFrameTs) / 1000, 0.05);
            lastFrameTs = timestamp;
            gameTime += dt;

            // –°—Ç—Ä–µ–ª—å–±–∞
            shootTimer -= dt;
            if ((rightMouseDown || keys["Space"]) && shootTimer <= 0) {
                shoot();
                shootTimer = player.shootCooldown;
            }

            player.update(dt);

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–∞–≥–æ–≤
            for (let i = enemies.length - 1; i >= 0; i--) {
                const e = enemies[i];
                e.update(dt);

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ø–∞–¥–∞–Ω–∏–π —Å–Ω–∞—Ä—è–¥–æ–≤
                for (let j = projectiles.length - 1; j >= 0; j--) {
                    const p = projectiles[j];
                    const d = Math.hypot(e.x - p.x, e.y - p.y);
                    if (d < e.size + p.size) {
                        e.health -= p.damage;
                        projectiles.splice(j, 1);
                        break;
                    }
                }

                // –°–º–µ—Ä—Ç—å –≤—Ä–∞–≥–∞
                if (e.health <= 0) {
                    // –í—ã–ø–∞–¥–µ–Ω–∏–µ –º–æ–Ω–µ—Ç —Å —Ä–∞–∑–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
                    let coinValue = 5; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 5 –º–æ–Ω–µ—Ç
                    if (e.type === 'boss') {
                        coinValue = 50; // –ë–æ—Å—Å –¥–∞–µ—Ç 50 –º–æ–Ω–µ—Ç
                    }
                    
                    // –°–æ–∑–¥–∞–µ–º –æ–¥–Ω—É –º–æ–Ω–µ—Ç—É —Å –Ω—É–∂–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º
                    coins.push(new Coin(e.x, e.y, coinValue));
                    
                    // –®–∞–Ω—Å –≤—ã–ø–∞–¥–µ–Ω–∏—è –∞–ø—Ç–µ—á–∫–∏
                    if (Math.random() < 0.1) {
                        healthPickups.push(new HealthPickup(e.x, e.y));
                    }
                    
                    enemies.splice(i, 1);
                    
                    // –ï—Å–ª–∏ —É–º–µ—Ä –±–æ—Å—Å
                    if (e.type === 'boss') {
                        currentBoss = null;
                        // –ë–æ—Å—Å —É–∂–µ –¥–∞–µ—Ç 50 –º–æ–Ω–µ—Ç —á–µ—Ä–µ–∑ –º–æ–Ω–µ—Ç—É –≤—ã—à–µ
                    }
                }
            }

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–Ω–∞—Ä—è–¥–æ–≤
            for (let i = projectiles.length - 1; i >= 0; i--) {
                const p = projectiles[i];
                p.update(dt);
                if (p.life <= 0 ||
                    p.x < 0 || p.y < 0 ||
                    p.x > WORLD_WIDTH || p.y > WORLD_HEIGHT) {
                    projectiles.splice(i, 1);
                }
            }

            // –°–±–æ—Ä –º–æ–Ω–µ—Ç
            for (let i = coins.length - 1; i >= 0; i--) {
                const coin = coins[i];
                coin.update(dt);
                const d = Math.hypot(player.x - coin.x, player.y - coin.y);
                if (d < player.size + coin.size + 5) {
                    player.addCoins(coin.value);
                    coins.splice(i, 1);
                }
            }

            // –°–±–æ—Ä –∞–ø—Ç–µ—á–µ–∫
            for (let i = healthPickups.length - 1; i >= 0; i--) {
                const hp = healthPickups[i];
                const d = Math.hypot(player.x - hp.x, player.y - hp.y);
                if (d < player.size + hp.size + 5) {
                    player.health = Math.min(player.maxHealth, player.health + 30);
                    healthPickups.splice(i, 1);
                }
            }

            // –ü–æ—Ä–∞–∂–µ–Ω–∏–µ
            if (player.health <= 0) {
                endGame();
                return;
            }

            // –ù–æ–≤–∞—è –≤–æ–ª–Ω–∞
            if (enemies.length === 0) {
                spawnWave();
            }

            // –ö–∞–º–µ—Ä–∞
            camera.x = clamp(player.x - canvas.width / 2, 0, WORLD_WIDTH - canvas.width);
            camera.y = clamp(player.y - canvas.height / 2, 0, WORLD_HEIGHT - canvas.height);

            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞
            drawScene();

            requestAnimationFrame(gameLoop);
        }

        // ---------- –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å—Ü–µ–Ω—ã ----------
        function drawScene() {
            // –¢—ë–º–Ω—ã–π —Ñ–æ–Ω
            ctx.fillStyle = "#0a0a0a";
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // –õ–µ—Å–Ω–æ–π —Ñ–æ–Ω
            const tileScreenSize = TILE_SIZE;
            const startX = Math.floor(camera.x / TILE_SIZE) * TILE_SIZE;
            const startY = Math.floor(camera.y / TILE_SIZE) * TILE_SIZE;

            for (let x = startX; x < camera.x + canvas.width; x += TILE_SIZE) {
                for (let y = startY; y < camera.y + canvas.height; y += TILE_SIZE) {
                    const sx = x - camera.x;
                    const sy = y - camera.y;
                    const noise = ((x ^ y) & 32) ? 0.02 : -0.02;
                    const darkness = 0.15 + Math.sin(x * 0.001 + y * 0.001) * 0.05;
                    ctx.fillStyle = `rgba(30, 41, 59, ${darkness + noise})`;
                    ctx.fillRect(sx, sy, tileScreenSize, tileScreenSize);
                }
            }

            // –ü—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
            for (const o of obstacles) {
                const sx = o.x - camera.x;
                const sy = o.y - camera.y;
                if (sx < -60 || sy < -60 ||
                    sx > canvas.width + 60 ||
                    sy > canvas.height + 60) continue;

                if (o.type === "tree") {
                    ctx.fillStyle = "#1e293b";
                    ctx.fillRect(sx - 3, sy - o.r * 0.8, 6, o.r * 1.6);
                    
                    ctx.fillStyle = "#064e3b";
                    ctx.beginPath();
                    ctx.arc(sx, sy, o.r, 0, Math.PI * 2);
                    ctx.fill();
                } else {
                    ctx.fillStyle = "#374151";
                    ctx.beginPath();
                    ctx.arc(sx, sy, o.r, 0, Math.PI * 2);
                    ctx.fill();
                    
                    ctx.fillStyle = "#4b5563";
                    ctx.beginPath();
                    ctx.arc(sx - o.r * 0.3, sy - o.r * 0.3, o.r * 0.4, 0, Math.PI * 2);
                    ctx.fill();
                }
            }

            // –û–±—ä–µ–∫—Ç—ã
            for (const hp of healthPickups) hp.draw(camera);
            for (const coin of coins) coin.draw(camera);
            for (const e of enemies) e.draw(camera);
            for (const p of projectiles) p.draw(camera);
            player.draw(camera);

            // UI
            updateUI();
            document.getElementById("timeText").textContent = Math.floor(gameTime);

            // –ú–∏–Ω–∏–∫–∞—Ä—Ç–∞
            drawMinimap();
        }

        // ---------- –ú–∏–Ω–∏–∫–∞—Ä—Ç–∞ ----------
        function drawMinimap() {
            const W = minimapCanvas.width;
            const H = minimapCanvas.height;
            minimapCtx.clearRect(0, 0, W, H);
            
            // –°–µ—Ä—ã–π —Ñ–æ–Ω
            minimapCtx.fillStyle = "rgba(128, 128, 128, 0.3)";
            minimapCtx.fillRect(0, 0, W, H);

            const scaleX = W / WORLD_WIDTH;
            const scaleY = H / WORLD_HEIGHT;
            const s = Math.min(scaleX, scaleY);

            // –†–∞–º–∫–∞
            minimapCtx.strokeStyle = "#808080";
            minimapCtx.lineWidth = 2;
            minimapCtx.strokeRect(4, 4, W - 8, H - 8);

            function drawDot(obj, color, size) {
                const x = obj.x * s;
                const y = obj.y * s;
                minimapCtx.fillStyle = color;
                minimapCtx.beginPath();
                minimapCtx.arc(x, y, size, 0, Math.PI * 2);
                minimapCtx.fill();
            }

            function drawBossIcon(x, y, size, pulse) {
                const pulseSize = Math.sin(pulse) * 2;
                
                minimapCtx.fillStyle = "#8b0000";
                minimapCtx.beginPath();
                minimapCtx.arc(x, y, size + pulseSize, 0, Math.PI * 2);
                minimapCtx.fill();
                
                minimapCtx.fillStyle = "#ff0000";
                minimapCtx.beginPath();
                minimapCtx.arc(x, y, size * 0.7 + pulseSize, 0, Math.PI * 2);
                minimapCtx.fill();
                
                minimapCtx.fillStyle = "#ffffff";
                minimapCtx.font = "bold 8px Arial";
                minimapCtx.textAlign = "center";
                minimapCtx.textBaseline = "middle";
                minimapCtx.fillText("B", x, y);
            }

            // –í—Ä–∞–≥–∏
            for (const e of enemies) {
                if (e.type === "fast") {
                    drawDot(e, "#3b82f6", 3); // –°–∏–Ω–∏–µ –º–æ–Ω—Å—Ç—Ä—ã
                } else if (e.type === "boss") {
                    drawBossIcon(e.x * s, e.y * s, 6, e.pulse);
                } else {
                    drawDot(e, "#dc2626", 2); // –ö—Ä–∞—Å–Ω—ã–µ –º–æ–Ω—Å—Ç—Ä—ã
                }
            }

            // –ò–≥—Ä–æ–∫
            drawDot(player, "#3b82f6", 4);

            // –ú–æ–Ω–µ—Ç—ã
            for (const coin of coins) {
                drawDot(coin, "#fbbf24", 1);
            }

            // –ü—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è (—Å–µ—Ä—ã–µ —Ç–æ—á–∫–∏)
            for (const o of obstacles) {
                minimapCtx.fillStyle = "rgba(96, 96, 96, 0.5)";
                minimapCtx.beginPath();
                minimapCtx.arc(o.x * s, o.y * s, Math.max(1, o.r * s * 0.3), 0, Math.PI * 2);
                minimapCtx.fill();
            }
        }

        // ---------- –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–≥—Ä—ã ----------
        function endGame() {
            gameRunning = false;
            hideAllScreens();
            const over = document.getElementById("gameOverScreen");
            over.style.display = "flex";
            document.getElementById("gameOverTitle").textContent = "–í–´ –ü–†–û–ò–ì–†–ê–õ–ò!";
            document.getElementById("finalTime").textContent = Math.floor(gameTime);
            document.getElementById("finalWave").textContent = wave - 1;
            document.getElementById("finalCoins").textContent = player.coins;
            
            let weaponName = "–ë–∞–∑–æ–≤–∞—è";
            switch(player.weapon) {
                case 'pistol': weaponName = "–ü–∏—Å—Ç–æ–ª–µ—Ç"; break;
                case 'shotgun': weaponName = "–î—Ä–æ–±–æ–≤–∏–∫"; break;
                case 'machinegun': weaponName = "–ü—É–ª–µ–º—ë—Ç"; break;
            }
            document.getElementById("finalWeapon").textContent = weaponName;
        }
    </script>
</body>
</html>
